{extends file="admin-layout.tpl"}

{block name="no-return-functions"}
  {$admin_current_location = 'modules'}
{/block}

{block name="page-title"}{intl l='GoogleShopping'}{/block}

{block name="check-auth"}
  {check_auth role="ADMIN" module=$module_code access="view" login_tpl="/admin/login"}
{/block}

{block name="main-content"}
  {default_translation_domain domain='googleshopping.bo.default'}
  {if isset($smarty.get.current_cat)}
    {assign var="curr_cat" value=$smarty.get.current_cat}
  {/if}
  {assign var="tab" value="configuration"}
  {if isset($smarty.get.current_tab)}
    {assign var="tab" value=$smarty.get.current_tab}
    {if $tab == ""}
      {assign var="tab" value="configuration"}
    {/if}
  {/if}
  <div class="modules-configure">

    <div id="wrapper" class="container">
      <div class="clearfix">
        <ul class="breadcrumb pull-left">
          <li><a href="{url path='/admin/home'}">{intl l="Home"}</a></li>
          <li><a href="{url path='/admin/modules'}">{intl l="Modules"}</a></li>
          <li><a href="#">{intl l="Configure"} : GoogleShopping</a></li>
        </ul>
      </div>

      {hook name="module.configuration" location="module_configuration"  modulecode="$module_code"}

      {oAuthCheckToken}
      <div class="general-block-decorator">
        <div class="row">
          <div class="col-md-12">
            <ul id="tabbed-menu" class="nav nav-tabs">
              <li class="{if $tab eq "configuration"}active{/if}"><a data-toggle="tab"
                                                                     href="#configuration">{intl l="Configuration"}</a>
              </li>
              <li class="{if $tab eq "management"}active{/if}"><a data-toggle="tab"
                                                                  href="#management">{intl l="Categories management"}</a>
              </li>
            </ul>

            <div class="tab-content">
              <div id="configuration"
                   class="tab-pane {if $tab eq "configuration"}active{/if} form-container">
                <div class="panel panel-default">
                  {form name="googleshopping.api.configuration"}
                    <form method="post" action='{url path="/admin/module/googleshopping/api"}'>
                      <div class="panel-heading">
                        <h4>{intl l="Google Api configuration"}</h4>
                        {include
                        file      = "includes/inner-form-toolbar.html"
                        hide_flags = true
                        close_url = {url path='/admin/modules'}
                        }
                      </div>
                      <div class="panel-body">
                        {form_hidden_fields form=$form}
                        <div class="col-md-12">
                          <div class="row">
                            {form_field form=$form field="application_name"}
                              <div class="form-group col-md-6 {if $error}has-error{/if}">
                                <label for="{$label_attr.for}">{$label}</label>
                                <input id="{$label_attr.for}" class="form-control"
                                       name="{$name}" value="{$value}" required/>
                                <span class="help-block">{intl l="The application name you have define when you have create the api application"}</span>
                              </div>
                            {/form_field}

                            {form_field form=$form field="client_id"}
                              <div class="form-group col-md-6 {if $error}has-error{/if}">
                                <label for="{$label_attr.for}">{$label}</label>
                                <input id="{$label_attr.for}" class="form-control"
                                       type="text" name="{$name}" value="{$value}"
                                       required/>
                                <span class="help-block">{intl l="The client ID of the api who can be found in https://console.developers.google.com at APIs & auth > Credentials"}</span>
                              </div>
                            {/form_field}

                            {form_field form=$form field="client_secret"}
                              <div class="form-group col-md-6 {if $error}has-error{/if}">
                                <label for="{$label_attr.for}">{$label}</label>
                                <input id="{$label_attr.for}" class="form-control"
                                       type="text" name="{$name}" value="{$value}"
                                       required/>
                                <span class="help-block">{intl l="The client secret associate to client ID"}</span>
                              </div>
                            {/form_field}
                          </div>
                        </div>
                      </div>
                    </form>
                  {/form}
                </div>
                <div class="panel panel-default">
                  {form name="googleshopping.merchant.configuration"}
                    <form method="post"
                          action='{url path="/admin/module/googleshopping/merchant/configuration"}'>
                      <div class="panel-heading">
                        <h4>{intl l="Google Merchant configuration"}</h4>

                        {include
                        file      = "includes/inner-form-toolbar.html"
                        hide_flags = true
                        close_url = {url path='/admin/modules'}
                        }
                      </div>
                      <div class="panel-body">

                        {form_hidden_fields form=$form}
                        <div class="col-md-12">
                          <div class="row">
                            {form_field form=$form field="merchant_id"}
                              <div class="form-group col-md-6 {if $error}has-error{/if}">
                                <label for="{$label_attr.for}">{$label}</label>
                                <input id="{$label_attr.for}" class="form-control"
                                       name="{$name}" value="{$value}" required/>
                                <span class="help-block">{intl l="Your google merchant ID, can be found in Google Merchant center, normally the numbers at top right"}</span>
                              </div>
                            {/form_field}

                            {form_field form=$form field="target_country_id"}
                              <div class="form-group col-md-6 {if $error}has-error{/if}">
                                <label for="{$label_attr.for}">{$label}</label>
                                <select id="{$label_attr.for}" class="form-control"
                                        name="{$name}">
                                  {loop type="country" name="target_country"}
                                    <option value="{$ID}"
                                            {if $value == $ID}selected{/if} >{$TITLE}</option>
                                  {/loop}
                                </select>
                                <span class="help-block">{intl l="The target country for Google Shopping"}</span>
                              </div>
                            {/form_field}

                            {form_field form=$form field="attribute_color"}
                              <div class="form-group col-md-6 {if $error}has-error{/if}">
                                <label for="{$label_attr.for}">{$label}</label>
                                <input id="{$label_attr.for}" class="form-control"
                                       name="{$name}" value="{$value}"/>
                                <span class="help-block">{intl l="The ID of thelia color attributes if you have one"}</span>
                              </div>
                            {/form_field}

                            {form_field form=$form field="attribute_size"}
                              <div class="form-group col-md-6 {if $error}has-error{/if}">
                                <label for="{$label_attr.for}">{$label}</label>
                                <input id="{$label_attr.for}" class="form-control"
                                       name="{$name}" value="{$value}"/>
                                <span class="help-block">{intl l="The ID of thelia size attributes if you have one"}</span>
                              </div>
                            {/form_field}
                          </div>
                        </div>
                      </div>
                    </form>
                  {/form}

                </div>
                <div>
                  <div class="alert alert-info col-md-12"
                       role="alert">{intl l="Url to call for Cron sync :"} {url path="/admin/module/googleshopping/sync/catalog/"}{$sync_secret}</div>
                </div>
              </div>

              <div id="management" class="tab-pane {if $tab eq "management"}active{/if} form-container">
                <div class="panel panel-default">
                  <div class="panel-heading clearfix">
                    <h4>{intl l="Choose association language"}</h4>

                    <div class="row inner-toolbar{if $page_bottom} inner-toolbar-bottom{/if}">
                      <div class="col-md-3 inner-actions">
                        <ul class="nav nav-pills">
                          {loop name="lang_list" type="lang"}
                            <li {if $ID == $edit_language_id}class="active"{/if}>
                              {if $current_tab}
                                {$lang_url = {url path={$page_url|default:$current_url nofilter} edit_language_id=$ID current_tab=$current_tab}}
                              {else}
                                {$lang_url = {url path={$page_url|default:$current_url nofilter} edit_language_id=$ID}}
                              {/if}
                              <a class="language-change-button" data-language-id="{$ID}"
                                 href="{$lang_url nofilter}"
                                 title="{intl l='Edit information in %lng' lng={$TITLE}}">
                                <img src="{image file="assets/img/flags/$CODE.png"}"
                                     alt=$TITLE/>
                              </a>
                            </li>
                          {/loop}
                        </ul>
                      </div>
                    </div>
                  </div>
                  <div class="panel-body">
                    {form name="googleshopping.taxonomy"}
                      <form action="{url path="/admin/modules/googleshopping/taxonomy/associate"}"
                            method="post">
                        {form_hidden_fields form=$form}
                        {form_field form=$form field="lang"}
                          <input type="hidden" name="{$name}" value="{$edit_language_id}">
                        {/form_field}
                        <div class="col-md-12">
                          <div class="row">
                            <div class="form-group col-md-3">
                              {form_field form=$form field="thelia_category_id"}
                                <label for="thelia-category">{intl l="Thelia category"}</label>
                                <select id="thelia-category" class="form-control"
                                        name="{$name}">
                                  {loop type="category" name="thelia-category"}
                                    <option value="{$ID}">{$TITLE}</option>
                                  {/loop}
                                </select>
                              {/form_field}
                            </div>
                            <div class="form-group col-md-3">
                              <label for="search-taxonomy">{intl l="Search category"}</label>

                              <div class="input-group">
                                <input class="form-control" type="text"
                                       id="search-taxonomy"/>
                                                    <span class="input-group-addon">
                                                        <span class="glyphicon glyphicon-arrow-right"></span>
                                                    </span>
                              </div>
                            </div>
                            <div class="form-group col-md-3">
                              {form_field form=$form field="google_category"}
                                <label for="google-taxonomy">{intl l="Google Category"}</label>
                                <select class="form-control" name="{$name}"
                                        id="google-taxonomy">

                                </select>
                              {/form_field}
                            </div>
                            <div class="form-group col-md-3">
                              <label class="control-label">&nbsp;</label>
                              <button class="btn btn-default btn-primary form-control"
                                      type="submit">
                                <span class="glyphicon glyphicon-check"></span>
                                {intl l="Associate"}
                              </button>
                            </div>
                          </div>
                        </div>
                      </form>
                    {/form}
                    <div class="table-responsive col-md-12">
                      <table class="table table-striped table-condensed table-left-aligned">
                        <caption class="clearfix">
                          {intl l="GoogleShopping associated categories"}
                        </caption>
                        {loop type="googleshopping.category.associated" lang_id={$edit_language_id} name="googleshopping_category_associated"}
                        {if $LOOP_COUNT === 1}
                          <thead>
                          <tr>
                            <th>{intl l="Thelia category Id"}</th>
                            <th>{intl l="Thelia category Title"}</th>
                            <th>{intl l="Associated Google category"}</th>
                            <th>{intl l="Action"}</th>
                          </tr>
                          </thead>
                        {/if}
                          <tbody>
                          <tr>
                            <td>
                              {$THELIA_CATEGORY_ID}
                            </td>
                            <td>
                              {$THELIA_CATEGORY_TITLE}
                            </td>
                            <td>
                              {$GOOGLE_CATEGORY}
                            </td>
                            <td>
                              <a href="{url path="/admin/module/GoogleShopping/category/management/%id" id=$THELIA_CATEGORY_ID}">{intl l="Manage product"}</a>
                            </td>
                          </tr>
                          </tbody>
                        {/loop}
                        {elseloop rel="googleshopping_category_associated"}
                          <tbody>
                          <tr>
                            <td>
                              <p class="alert alert-info" role="alert">
                                {intl l="No associated category"}
                              </p>
                            </td>
                          </tr>
                          </tbody>
                        {/elseloop}
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{/block}

{block name="javascript-initialization"}
  {include file="google-shopping/configuration-js.html"}
{/block}

{block name="javascript-last-call"}

{/block}