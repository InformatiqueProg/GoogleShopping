<script>
    $(function() {
        $("#search-taxonomy").keyup(function(){
            search = $(this).val();
            if (search.length > 2) {
                $.get('{url path="/admin/module/googleshopping/taxonomy"}', function(data) {
                    var lines = data.split("\n");
                    var res = "";
                    for (var i = 0, len = lines.length; i < len; i++) {
                        var searchUp = search.toUpperCase();
                        var linesUp = lines[i].toUpperCase();
                        if (-1 !== linesUp.search(searchUp)) {
                            res += "<option value='"+lines[i]+"'>"+lines[i]+"</option>";
                        }

                    }
                    $("#google-taxonomy").html(res);
                })
            }
        });

        $(".check-all-gtin").click(function(event) {
            var catId = $(this).data("category");
            if(this.checked) {
                $('.check-gtin-'+catId).each(function() {
                    this.checked = true;
                });
            } else {
                $('.check-gtin-'+catId).each(function() {
                    this.checked = false;
                });
            }
        });

        $(".check-gtin").click(function(event) {
            var prodId = $(this).data("id");
            if(this.checked) {
                $('#gtin-product-'+prodId).val('on')
            } else {
                $('#gtin-product-'+prodId).val('off');
            }
        });

        $(".check-all-product").click(function(event) {
            var catId = $(this).data("category");
            if(this.checked) {
                $('.check-product-'+catId).each(function() {
                    this.checked = true;
                });
            } else {
                $('.check-product-'+catId).each(function() {
                    this.checked = false;
                });
            }
        });

        $(".send-checked").click(function (event) {
            var catId = $(this).data("category");
            $('.check-product-'+catId+':checked').each(function() {
                var productId = $(this).data("product");
                $(".td-product-"+productId+":first").html('<span class="loading" style="margin:auto"></span>');
                var form = $("#form-product-"+productId);
                form.append("<input type='hidden' name='ajax' value='true'>");
                $.ajax({
                    url: form.attr('action'),
                    type: form.attr('method'),
                    data: form.serialize()
                }).fail(function(jqXHR, textStatus, errorThrown) {
                    $(".td-product-" + productId).remove();
                    $("#tr-product-"+productId).addClass("danger").append("<td colspan='2'>"+jqXHR.responseText+"</td>");
                }).done(function(data){
                    $(".td-product-" + productId).remove();
                    $("#tr-product-"+productId).addClass("success").append("<td colspan='2'>{intl l="Product added with success"}</td>");
                })
            });
        });
    })
</script>